
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travelz</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }
        canvas {
            display: block;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="info">
        <!-- Drag to rotate • Scroll to zoom -->
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, earth;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let autoRotate = true;
        let lastTouchDistance = 0;

        function init() {
            // Scene
            scene = new THREE.Scene();

            // Camera
            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.z = 3;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 1);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 3, 5);
            scene.add(directionalLight);

            // Earth
            const geometry = new THREE.SphereGeometry(1, 64, 64);
            
            // Load Earth texture from online source
            const textureLoader = new THREE.TextureLoader();
            const earthTexture = textureLoader.load(
                'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/planets/earth_atmos_2048.jpg',
                function() {
                    console.log('Texture loaded successfully');
                },
                undefined,
                function(err) {
                    console.error('Error loading texture:', err);
                }
            );

            const material = new THREE.MeshPhongMaterial({
                map: earthTexture,
                shininess: 10
            });

            earth = new THREE.Mesh(geometry, material);
            scene.add(earth);

            // City coordinates map
            const cities = {
                'Amsterdam': [52.374, 4.8897],
                'Bogota': [4.6097, -74.0818],
                'Houston': [29.7604, -95.3698],
                'New York': [40.7128, -74.0060],
                'San Francisco': [37.7749, -122.4194],
                'Denver': [39.7392, -104.9903],
                'Miami': [25.7617, -80.1918],
                'Medellin': [6.2442, -75.5812],
                'Panama': [8.9833, -79.5167],
                'Cartagena': [10.3910, -75.5143],
                'Santa Marta': [11.2408, -74.1990],
                'Paris': [48.8566, 2.3522],
                'Berlin': [52.5200, 13.4050],
                'Munich': [48.1351, 11.5820],
                'Tokyo': [35.6762, 139.6503],
                'Kyoto': [35.0116, 135.7681],
                'Porto': [41.1496, -8.6110],
                'Tromso': [69.6496, 18.9560],
                'Singapore': [1.3521, 103.8198],
                'Barcelona': [41.3784, 2.1915],
                'Rome': [41.9028, 12.4964],
                'Madrid': [40.4168, -3.7038],
                'Buenos Aires': [-34.6037, -58.3816],
                'Frankfurt': [50.1109, 8.6821],
                'London': [51.5074, -0.1278],
                'Bordeaux': [44.8378, -0.5792],
                'Mexico City': [19.4326, -99.1332],
                'Split': [43.5081, 16.4402],
                'San Andres': [12.5847, -81.7006],
                'Cali': [3.4516, -76.5319],
                'Tunja': [5.5444, -73.3576],
                'Villa de Leyva': [5.6350, -73.5263],
                'Mountain View': [37.3861, -122.0839],
                'Big Sur': [36.3615, -121.8563],
                'Monterey': [36.6002, -121.8947],
                'Los Angeles': [34.0522, -118.2437],
                'Orlando': [28.5383, -81.3792],
                'Key West': [24.5551, -81.7800],
                'Bucaramanga': [7.1193, -73.1227],
                'Wroclaw': [51.1079, 17.0385],
                'Krakow': [50.0647, 19.9450],
                'Warsaw': [52.2297, 21.0122],
                'Darmstadt': [49.8728, 8.6512],
                'Potsdam': [52.3906, 13.0645],
                'Koln': [50.9375, 6.9603],
                'Triberg': [48.1310, 8.2326],
                'Rothenburg': [49.3780, 10.1797],
                'Nuremberg': [49.4521, 11.0767],
                'Abensberg': [48.8167, 11.8500],
                'Freising': [48.4029, 11.7480],
                'Regensburg': [49.0134, 12.1016],
                'Toulouse': [43.6047, 1.4442],
                'Albi': [43.9270, 2.1480],
                'Utrecht': [52.0907, 5.1214],
                'Rotterdam': [51.9244, 4.4777],
                'Haarlem': [52.3874, 4.6462],
                'Nijmegen': [51.8437, 5.8520],
                'Himeji': [34.8151, 134.6853],
                'Kanazawa': [36.5613, 136.6562],
                'Sendai': [38.2682, 140.8694],
                'Matsushima': [38.3704, 141.0618],
                'Aomori': [40.8221, 140.7474],
                'Hakodate': [41.7687, 140.7288],
                'Stuttgart': [48.7758, 9.1829],
                'Maastricht': [50.8514, 5.6910],
                'Bruges': [51.2093, 3.2247],
                'La Pintada': [5.7489, -75.6067],
                'Manizales': [5.0689, -75.5174],
                'Santa Fe de Antioquia': [6.5569, -75.8286],
                'San Gil': [6.5548, -73.1331],
                'Fusagasuga': [4.3365, -74.3633],
                'Shirakawa-go': [36.2653, 136.8986],
                'Freiburg': [47.9990, 7.8421],
                'Ansbach': [49.3000, 10.5833],
                'Lauterbourg': [48.9775, 8.1446],
                'Karlsruhe': [49.0069, 8.4037],
                'Heidelberg': [49.3988, 8.6724],
                'Mainz': [50.0000, 8.2711],
                'Wiesbaden': [50.0826, 8.2410],
                'Kandel': [49.0711, 7.7024],
                'Brussels': [50.8503, 4.3517],
                'Leipzig': [51.3397, 12.3731],
                'Erfurt': [50.9848, 11.0299],
                'Wurzburg': [49.7913, 9.9534],
                'Offenburg': [48.4738, 7.9445],
                'Poznan': [52.4064, 16.9252],
                'Hamburg': [53.5511, 9.9937],
                'Groningen': [53.2194, 6.5665],
                'Fukuoka': [33.5902, 130.4017],
                'Lübeck': [53.8686, 10.6866],
                'Bremen': [53.0793, 8.8017],
                'Greifswald': [54.0924, 13.3873],
                'Stettin': [53.4285, 14.5528],
                'Gdansk': [54.3520, 18.6466],
                'Valencia': [39.4699, -0.3763],
                'Mont Saint-Michel': [48.6361, -1.5115],
                'Edinburgh': [55.9533, -3.1883],
                'Toronto': [43.6511, -79.3470],
                'Montreal': [45.5017, -73.5673],
                'Santiago de Chile': [-33.4489, -70.6693],
                'Milan': [45.4642, 9.1900],
                'Venice': [45.4408, 12.3155],
                'Oslo': [59.9139, 10.7522],
                'Copenhagen': [55.6761, 12.5683],
                'Zurich': [47.3769, 8.5417],
                'Basel': [47.5596, 7.5886],
                'Istanbul': [41.0082, 28.9784],
                'Dublin': [53.3331, -6.2489],
                'Stockholm': [59.3293, 18.0686],
                'Athens': [37.9838, 23.7275],
                'Dubrovnik': [42.6507, 18.0944],
                'Belgrade': [44.8176, 20.4569],
                'Seoul': [37.5665, 126.9780],
                'Hong Kong': [22.3193, 114.1694],
                'Taipei': [25.0330, 121.5654],
                'Sydney': [-33.8688, 151.2093],
                'Canberra': [-35.2809, 149.1300],
                'Perth': [-31.9505, 115.8605],
                'Düsseldorf': [51.2277, 6.7735],
                'Konstanz': [47.6779, 9.1730],
                'Strasbourg': [48.5734, 7.7521],
                'Oxford': [51.7520, -1.2577],
                'Prague': [50.0755, 14.4378]
            };

            // Helper function to get coordinates from city name
            function getCoords(cityName) {
                const coords = cities[cityName];
                if (!coords) {
                    console.error(`City "${cityName}" not found in cities map`);
                    return [0, 0];
                }
                return coords;
            }

            // Helper function to create arc using city names
            function createArcBetween(city1, city2) {
                const [lat1, lon1] = getCoords(city1);
                const [lat2, lon2] = getCoords(city2);
                createArc(lat1, lon1, lat2, lon2);
            }

            // Helper function to create land arc using city names
            function createLandArcBetween(city1, city2) {
                const [lat1, lon1] = getCoords(city1);
                const [lat2, lon2] = getCoords(city2);
                createLandArc(lat1, lon1, lat2, lon2);
            }

            // Helper function to create mixed arc using city names
            function createMixedArcBetween(city1, city2) {
                const [lat1, lon1] = getCoords(city1);
                const [lat2, lon2] = getCoords(city2);
                createMixedArc(lat1, lon1, lat2, lon2);
            }

            // Helper function to add marker using city name
            function addCityMarkerByName(cityName) {
                const [lat, lon] = getCoords(cityName);
                addCityMarker(lat, lon);
            }

            function addTransitMarkerByName(cityName) {
                const [lat, lon] = getCoords(cityName);
                addTransitMarker(lat, lon);
            }

            function addWishMarkerByName(cityName) {
                const [lat, lon] = getCoords(cityName);
                addWishMarker(lat, lon);
            }

            // Create arc between coordinates
            createArcBetween('Amsterdam', 'Bogota');
            createArcBetween('Bogota', 'Houston');
            createArcBetween('Bogota', 'New York');
            createArcBetween('New York', 'San Francisco');
            createArcBetween('San Francisco', 'Denver');
            createArcBetween('San Francisco', 'Houston');
            createArcBetween('San Francisco', 'Miami');
            createArcBetween('Medellin', 'Miami');
            createArcBetween('Medellin', 'Panama');
            createArcBetween('Medellin', 'Cartagena');
            createArcBetween('Medellin', 'Santa Marta');
            createArcBetween('Cartagena', 'Amsterdam');
            createArcBetween('Amsterdam', 'Paris');
            createArcBetween('Berlin', 'Paris');
            createArcBetween('Berlin', 'Munich');
            createArcBetween('Munich', 'Tokyo');
            createArcBetween('Tokyo', 'Kyoto');
            createArcBetween('Berlin', 'Porto');
            createArcBetween('Berlin', 'Tromso');
            createArcBetween('Berlin', 'Miami');
            createArcBetween('Bogota', 'Cartagena');
            createArcBetween('Amsterdam', 'Singapore');
            createArcBetween('Amsterdam', 'Barcelona');
            createArcBetween('Amsterdam', 'Rome');
            createArcBetween('Amsterdam', 'Munich');
            createArcBetween('Berlin', 'Barcelona');
            createArcBetween('Berlin', 'Madrid');
            createArcBetween('Paris', 'Barcelona');
            createArcBetween('Amsterdam', 'Buenos Aires');
            createArcBetween('Frankfurt', 'Buenos Aires');
            createArcBetween('Berlin', 'London');
            createArcBetween('Amsterdam', 'Bordeaux');
            createArcBetween('Frankfurt', 'Mexico City');
            createArcBetween('Mexico City', 'Medellin');
            createArcBetween('Miami', 'Munich');
            createArcBetween('Frankfurt', 'Bogota');
            createArcBetween('Amsterdam', 'Panama');
            createArcBetween('Berlin', 'Split');
            createArcBetween('Medellin', 'San Andres');
            createArcBetween('Madrid', 'Bogota');
            createArcBetween('Madrid', 'Medellin');
            createArcBetween('Amsterdam', 'Madrid');
            createArcBetween('Bogota', 'Cali');
            createArcBetween('Cali', 'Amsterdam');
            createArcBetween('Berlin', 'Frankfurt');

            // Land transport arcs
            createLandArcBetween('Bogota', 'Tunja');
            createLandArcBetween('Tunja', 'Villa de Leyva');
            createLandArcBetween('Mountain View', 'Big Sur');
            createLandArcBetween('Big Sur', 'Monterey');
            createLandArcBetween('Mountain View', 'Los Angeles');
            createLandArcBetween('Miami', 'Orlando');
            createLandArcBetween('Miami', 'Key West');
            createLandArcBetween('Mountain View', 'San Francisco');
            createLandArcBetween('Bucaramanga', 'Santa Marta');
            createLandArcBetween('Berlin', 'Wroclaw');
            createLandArcBetween('Wroclaw', 'Krakow');
            createLandArcBetween('Berlin', 'Warsaw');
            createLandArcBetween('Bordeaux', 'Toulouse');
            createLandArcBetween('Toulouse', 'Albi');
            createLandArcBetween('London', 'Oxford');
            createLandArcBetween('Amsterdam', 'Utrecht');
            createLandArcBetween('Amsterdam', 'Maastricht');
            createLandArcBetween('Frankfurt', 'Stuttgart');
            createLandArcBetween('Kyoto', 'Himeji');
            createLandArcBetween('Kanazawa', 'Shirakawa-go');
            createLandArcBetween('Kanazawa', 'Tokyo');
            createLandArcBetween('Tokyo', 'Sendai');
            createLandArcBetween('Sendai', 'Matsushima');
            createLandArcBetween('Sendai', 'Aomori');
            createLandArcBetween('Aomori', 'Hakodate');
            createLandArcBetween('Brussels', 'Bruges');
            createLandArcBetween('Abensberg', 'Regensburg');
            createLandArcBetween('Berlin', 'Prague');
            createLandArcBetween('Amsterdam', 'Rotterdam');
            createLandArcBetween('Rotterdam', 'Brussels');
            createLandArcBetween('Nijmegen', 'Koln');
            createLandArcBetween('Amsterdam', 'Utrecht');
            createLandArcBetween('Koln', 'Frankfurt');
            createLandArcBetween('Medellin', 'La Pintada');
            createLandArcBetween('La Pintada', 'Manizales');
            createLandArcBetween('Medellin', 'Santa Fe de Antioquia');
            createLandArcBetween('Medellin', 'Bogota');
            createLandArcBetween('Bogota', 'Bucaramanga');
            createLandArcBetween('Bucaramanga', 'Santa Marta');
            createLandArcBetween('Bogota', 'Fusagasuga');
            createLandArcBetween('Villa de Leyva', 'Bucaramanga');
            createLandArcBetween('Bucaramanga', 'San Gil');
            createLandArcBetween('Kyoto', 'Kanazawa');
            createLandArcBetween('Utrecht', 'Nijmegen');
            createLandArcBetween('Brussels', 'Paris');
            createLandArcBetween('Berlin', 'Leipzig');
            createLandArcBetween('Leipzig', 'Erfurt');
            createLandArcBetween('Erfurt', 'Würzburg');
            createLandArcBetween('Wurzburg', 'Rothenburg');
            createLandArcBetween('Rothenburg', 'Ansbach');
            createLandArcBetween('Ansbach', 'Nuremberg');
            createLandArcBetween('Nuremberg', 'Erfurt');
            createLandArcBetween('Munich', 'Freising');
            createLandArcBetween('Freising', 'Abensberg');
            createLandArcBetween('Abensberg', 'Regensburg');
            createLandArcBetween('Triberg', 'Freiburg');
            createLandArcBetween('Frankfurt', 'Karlsruhe');
            createLandArcBetween('Kandel', 'Lauterbourg');
            createLandArcBetween('Kandel', 'Karlsruhe');
            createLandArcBetween('Kandel', 'Heidelberg');
            createLandArcBetween('Frankfurt', 'Offenburg');
            createLandArcBetween('Offenburg', 'Triberg');
            createLandArcBetween('Berlin', 'Erfurt');
            createLandArcBetween('Erfurt', 'Frankfurt');


            // Overlapping transport arcs
            createMixedArcBetween('Medellin', 'Bogota');
            createMixedArcBetween('Medellin', 'Bucaramanga');
            createMixedArcBetween('Amsterdam', 'Berlin');

            // Add city markers
            addCityMarkerByName('Medellin');
            addCityMarkerByName('Bogota');
            addCityMarkerByName('Cartagena');
            addCityMarkerByName('Santa Marta');
            addCityMarkerByName('Tunja');
            addCityMarkerByName('Villa de Leyva');
            addCityMarkerByName('Manizales');
            addCityMarkerByName('Santa Fe de Antioquia');
            addCityMarkerByName('San Gil');
            addCityMarkerByName('San Andres');
            addCityMarkerByName('Mexico City');
            addCityMarkerByName('Buenos Aires');
            addCityMarkerByName('Miami');
            addCityMarkerByName('New York');
            addCityMarkerByName('San Francisco');
            addCityMarkerByName('Houston');
            addCityMarkerByName('Denver');
            addCityMarkerByName('Orlando');
            addCityMarkerByName('Monterey');
            addCityMarkerByName('Big Sur');
            addCityMarkerByName('Key West');
            addCityMarkerByName('Wroclaw');
            addCityMarkerByName('Krakow');
            addCityMarkerByName('Warsaw');
            addCityMarkerByName('Darmstadt');
            addCityMarkerByName('Frankfurt');
            addCityMarkerByName('Berlin');
            addCityMarkerByName('Potsdam');
            addCityMarkerByName('Koln');
            addCityMarkerByName('Munich');
            addCityMarkerByName('Triberg');
            addCityMarkerByName('Rothenburg');
            addCityMarkerByName('Nuremberg');
            addCityMarkerByName('Abensberg');
            addCityMarkerByName('Freising');
            addCityMarkerByName('Regensburg');
            addCityMarkerByName('Paris');
            addCityMarkerByName('Bordeaux');
            addCityMarkerByName('Toulouse');
            addCityMarkerByName('Albi');
            addCityMarkerByName('Madrid');
            addCityMarkerByName('Barcelona');
            addCityMarkerByName('Amsterdam');
            addCityMarkerByName('Utrecht');
            addCityMarkerByName('Rotterdam');
            addCityMarkerByName('Haarlem');
            addCityMarkerByName('Nijmegen');
            addCityMarkerByName('Tromso');
            addCityMarkerByName('Split');
            addCityMarkerByName('Porto');
            addCityMarkerByName('London');
            addCityMarkerByName('Oxford');
            addCityMarkerByName('Prague');
            addCityMarkerByName('Tokyo');
            addCityMarkerByName('Kyoto');
            addCityMarkerByName('Himeji');
            addCityMarkerByName('Kanazawa');
            addCityMarkerByName('Sendai');
            addCityMarkerByName('Matsushima');
            addCityMarkerByName('Aomori');
            addCityMarkerByName('Hakodate');
            addCityMarkerByName('Singapore');
            addCityMarkerByName('Stuttgart');
            addCityMarkerByName('Maastricht');
            addCityMarkerByName('Bruges');
            addCityMarkerByName('Rome');
            addCityMarkerByName('Panama');
            addCityMarkerByName('Bucaramanga');
            addCityMarkerByName('Mountain View');
            addCityMarkerByName('Los Angeles');
            addCityMarkerByName('La Pintada');
            addCityMarkerByName('Fusagasuga');
            addCityMarkerByName('Shirakawa-go');
            addCityMarkerByName('Freiburg');
            addCityMarkerByName('Ansbach');
            addCityMarkerByName('Lauterbourg');
            addCityMarkerByName('Karlsruhe');
            addCityMarkerByName('Heidelberg');
            addCityMarkerByName('Mainz');
            addCityMarkerByName('Wiesbaden');
            addCityMarkerByName('Kandel');


            // Add transit markers
            addTransitMarkerByName('Mexico City');
            addTransitMarkerByName('New York');
            addTransitMarkerByName('Panama');
            addTransitMarkerByName('Cartagena');
            addTransitMarkerByName('Madrid');
            addTransitMarkerByName('Munich');
            addTransitMarkerByName('Cali');
            addTransitMarkerByName('Brussels');
            addTransitMarkerByName('Leipzig');
            addTransitMarkerByName('Erfurt');
            addTransitMarkerByName('Wurzburg');
            addTransitMarkerByName('Offenburg');
            addTransitMarkerByName('Poznan');

            // Add wish markers
            addWishMarkerByName('Hamburg');
            addWishMarkerByName('Groningen');
            addWishMarkerByName('Fukuoka');
            addWishMarkerByName('Lübeck');
            addWishMarkerByName('Bremen');
            addWishMarkerByName('Greifswald');
            addWishMarkerByName('Stettin');
            addWishMarkerByName('Gdansk');
            addWishMarkerByName('Valencia');
            addWishMarkerByName('Mont Saint-Michel');
            addWishMarkerByName('Edinburgh');
            addWishMarkerByName('Toronto');
            addWishMarkerByName('Montreal');
            addWishMarkerByName('Santiago de Chile');
            addWishMarkerByName('Milan');
            addWishMarkerByName('Venice');
            addWishMarkerByName('Oslo');
            addWishMarkerByName('Copenhagen');
            addWishMarkerByName('Zurich');
            addWishMarkerByName('Basel');
            addWishMarkerByName('Istanbul');
            addWishMarkerByName('Dublin');
            addWishMarkerByName('Stockholm');
            addWishMarkerByName('Athens');
            addWishMarkerByName('Dubrovnik');
            addWishMarkerByName('Belgrade');
            addWishMarkerByName('Seoul');
            addWishMarkerByName('Hong Kong');
            addWishMarkerByName('Taipei');
            addWishMarkerByName('Sydney');
            addWishMarkerByName('Canberra');
            addWishMarkerByName('Perth');
            addWishMarkerByName('Düsseldorf');
            addWishMarkerByName('Konstanz');
            addWishMarkerByName('Strasbourg');









            // Mouse controls
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('wheel', onWheel);

            // Touch controls
            renderer.domElement.addEventListener('touchstart', onTouchStart, { passive: false });
            renderer.domElement.addEventListener('touchmove', onTouchMove, { passive: false });
            renderer.domElement.addEventListener('touchend', onTouchEnd);

            // Window resize
            window.addEventListener('resize', onWindowResize);

            animate();
        }

        function latLonToVector3(lat, lon, radius) {
            const phi = (90 - lat) * (Math.PI / 180);
            const theta = (lon + 180) * (Math.PI / 180);

            const x = -(radius * Math.sin(phi) * Math.cos(theta));
            const z = (radius * Math.sin(phi) * Math.sin(theta));
            const y = (radius * Math.cos(phi));

            return new THREE.Vector3(x, y, z);
        }

        function createArc(lat1, lon1, lat2, lon2) {
            const radius = 1; // Earth sphere radius
            const arcRadius = 1.005; // Just slightly above Earth surface

            // Convert lat/lon to 3D coordinates
            const start = latLonToVector3(lat1, lon1, radius);
            const end = latLonToVector3(lat2, lon2, radius);

            // Create curve with multiple points for smooth arc
            const numPoints = 100;
            const points = [];

            for (let i = 0; i <= numPoints; i++) {
                const t = i / numPoints;
                
                // Interpolate between start and end on the sphere surface
                const point = new THREE.Vector3().lerpVectors(start, end, t);
                
                // Normalize and project to sphere surface (great circle path)
                point.normalize().multiplyScalar(arcRadius);
                
                points.push(point);
            }

            // Create the arc line
            const curve = new THREE.CatmullRomCurve3(points);
            const arcPoints = curve.getPoints(200);
            const arcGeometry = new THREE.BufferGeometry().setFromPoints(arcPoints);
            
            const arcMaterial = new THREE.LineBasicMaterial({
                color: 0xff6b35,
                linewidth: 2,
                transparent: true,
                opacity: 0.9
            });

            const arcLine = new THREE.Line(arcGeometry, arcMaterial);
            earth.add(arcLine); // Add to earth so it rotates with it
        }

        function createLandArc(lat1, lon1, lat2, lon2) {
            const radius = 1; // Earth sphere radius
            const arcRadius = 1.005; // Just slightly above Earth surface

            // Convert lat/lon to 3D coordinates
            const start = latLonToVector3(lat1, lon1, radius);
            const end = latLonToVector3(lat2, lon2, radius);

            // Create curve with multiple points for smooth arc
            const numPoints = 100;
            const points = [];

            for (let i = 0; i <= numPoints; i++) {
                const t = i / numPoints;
                
                // Interpolate between start and end on the sphere surface
                const point = new THREE.Vector3().lerpVectors(start, end, t);
                
                // Normalize and project to sphere surface (great circle path)
                point.normalize().multiplyScalar(arcRadius);
                
                points.push(point);
            }

            // Create the arc line
            const curve = new THREE.CatmullRomCurve3(points);
            const arcPoints = curve.getPoints(200);
            const arcGeometry = new THREE.BufferGeometry().setFromPoints(arcPoints);
            
            const arcMaterial = new THREE.LineBasicMaterial({
                color: 0x00FF00,  // Green color for land transport
                linewidth: 2,
                transparent: true,
                opacity: 0.9
            });

            const arcLine = new THREE.Line(arcGeometry, arcMaterial);
            earth.add(arcLine); // Add to earth so it rotates with it
        }

        function createMixedArc(lat1, lon1, lat2, lon2) {
            const radius = 1; // Earth sphere radius
            const arcRadius = 1.005; // Just slightly above Earth surface

            // Convert lat/lon to 3D coordinates
            const start = latLonToVector3(lat1, lon1, radius);
            const end = latLonToVector3(lat2, lon2, radius);

            // Create curve with multiple points for smooth arc
            const numPoints = 100;
            const points = [];

            for (let i = 0; i <= numPoints; i++) {
                const t = i / numPoints;
                
                // Interpolate between start and end on the sphere surface
                const point = new THREE.Vector3().lerpVectors(start, end, t);
                
                // Normalize and project to sphere surface (great circle path)
                point.normalize().multiplyScalar(arcRadius);
                
                points.push(point);
            }

            // Create the arc line
            const curve = new THREE.CatmullRomCurve3(points);
            const arcPoints = curve.getPoints(200);
            const arcGeometry = new THREE.BufferGeometry().setFromPoints(arcPoints);
            
            const arcMaterial = new THREE.LineBasicMaterial({
                color: 0xFFFF00,  // Yellow color for overlapping transport
                linewidth: 2,
                transparent: true,
                opacity: 0.9
            });

            const arcLine = new THREE.Line(arcGeometry, arcMaterial);
            earth.add(arcLine); // Add to earth so it rotates with it
        }

        function addCityMarker(lat, lon) {
            addMarker(lat, lon, 0x90EE90) // Light green
        }

        function addTransitMarker(lat, lon) {
            addMarker(lat, lon, 0x00FFFF) // Light blue
        }

        function addWishMarker(lat, lon) {
            addMarker(lat, lon, 0xFFFFFF) // White
        }
        
        function addMarker(lat, lon, color) {
            const radius = 1.005; // Same as arc radius
            const position = latLonToVector3(lat, lon, radius);
            
            const markerGeometry = new THREE.CircleGeometry(0.0015, 32);
            const markerMaterial = new THREE.MeshBasicMaterial({
                color: color,
                side: THREE.DoubleSide
            });
            
            const marker = new THREE.Mesh(markerGeometry, markerMaterial);
            marker.position.copy(position);
            
            // Make the circle face outward from the Earth's center
            marker.lookAt(0, 0, 0);
            marker.rotateY(Math.PI);
            
            earth.add(marker);
        }

        function onMouseDown(e) {
            isDragging = true;
            autoRotate = false;
            previousMousePosition = { x: e.clientX, y: e.clientY };
        }

        function onMouseMove(e) {
            if (isDragging) {
                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;

                earth.rotation.y += deltaX * 0.005;
                earth.rotation.x += deltaY * 0.005;

                previousMousePosition = { x: e.clientX, y: e.clientY };
            }
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onWheel(e) {
            e.preventDefault();
            camera.position.z += e.deltaY * 0.001;
            camera.position.z = Math.max(1.2, Math.min(10, camera.position.z));
        }

        let touchStartPos = { x: 0, y: 0 };

        function onTouchStart(e) {
            if (e.touches.length === 1) {
                isDragging = true;
                autoRotate = false;
                touchStartPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                previousMousePosition = touchStartPos;
            } else if (e.touches.length === 2) {
                isDragging = false;
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                lastTouchDistance = Math.sqrt(dx * dx + dy * dy);
            }
        }

        function onTouchMove(e) {
            e.preventDefault();
            
            if (e.touches.length === 1 && isDragging) {
                const deltaX = e.touches[0].clientX - previousMousePosition.x;
                const deltaY = e.touches[0].clientY - previousMousePosition.y;

                earth.rotation.y += deltaX * 0.005;
                earth.rotation.x += deltaY * 0.005;

                previousMousePosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            } else if (e.touches.length === 2) {
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (lastTouchDistance > 0) {
                    const delta = distance - lastTouchDistance;
                    camera.position.z -= delta * 0.01;
                    camera.position.z = Math.max(1.2, Math.min(10, camera.position.z));
                }
                
                lastTouchDistance = distance;
            }
        }

        function onTouchEnd() {
            isDragging = false;
            lastTouchDistance = 0;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Auto-rotation only if not manually dragged
            if (autoRotate && !isDragging) {
                earth.rotation.y += 0.001;
            }

            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
